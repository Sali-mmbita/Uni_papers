<!-- templates/papers.html -->
{% extends "base.html" %}
{% block title %}All Papers - PastPapers Hub{% endblock %}

{% block content %}
<!--
  Global papers listing with search/filter at top.
  Expects: papers (paginate object)
-->
<div class="mb-3 d-flex justify-content-between align-items-center">
  <div>
    <h2 class="page-title mb-0">Explore Past Papers</h2>
    <p class="small-muted mb-0">Search by title, subject or year.</p>
  </div>
  <div>
    <a href="{{ url_for('main.upload') }}" class="btn btn-outline-primary btn-sm"><i class="bi bi-upload"></i> Contribute</a>
  </div>
</div>

<!-- Search & Filters -->
<form method="GET" action="{{ url_for('main.papers') }}" class="row g-2 mb-4">
  <div class="col-md-5">
    <input name="q" class="form-control" placeholder="Search title, subject, year" value="{{ request.args.get('q','') }}">
  </div>
  <div class="col-md-3">
    <input name="subject" class="form-control" placeholder="Subject" value="{{ request.args.get('subject','') }}">
  </div>
  <div class="col-md-2">
    <input name="year" class="form-control" placeholder="Year" value="{{ request.args.get('year','') }}">
  </div>
  <div class="col-md-2 d-grid">
    <button class="btn btn-primary" type="submit"><i class="bi bi-search"></i> Search</button>
  </div>
</form>

<!-- Cards grid -->
{% if papers.items %}
  <div class="row g-3">
    {% for paper in papers.items %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h6 class="card-title">{{ paper.title }}</h6>
          <p class="small-muted mb-1">{{ paper.subject }} · {{ paper.year or 'N/A' }}</p>
          <p class="small-muted mb-0">By {{ paper.author.username }} · {{ paper.uploaded_at.strftime('%Y-%m-%d') }}</p>
        </div>
        <div class="card-footer bg-white text-end">
          <a class="btn btn-sm btn-info me-1" href="{{ url_for('main.view_paper', paper_id=paper.id) }}"><i class="bi bi-eye"></i> View</a>
          <a class="btn btn-sm btn-success" href="{{ url_for('main.download', paper_id=paper.id) }}"><i class="bi bi-download"></i></a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- pagination -->
  <nav class="mt-4">
    <ul class="pagination justify-content-center">
      {% if papers.has_prev %}
        <li class="page-item"><a class="page-link" href="{{ url_for('main.papers', page=papers.prev_num, q=request.args.get('q'), subject=request.args.get('subject'), year=request.args.get('year')) }}">Prev</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Prev</span></li>
      {% endif %}

      {% for p in papers.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=1) %}
        {% if p %}
          {% if p == papers.page %}
            <li class="page-item active"><span class="page-link">{{ p }}</span></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="{{ url_for('main.papers', page=p, q=request.args.get('q'), subject=request.args.get('subject'), year=request.args.get('year')) }}">{{ p }}</a></li>
          {% endif %}
        {% else %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
      {% endfor %}

      {% if papers.has_next %}
        <li class="page-item"><a class="page-link" href="{{ url_for('main.papers', page=papers.next_num, q=request.args.get('q'), subject=request.args.get('subject'), year=request.args.get('year')) }}">Next</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
{% else %}
  <div class="alert alert-warning">No papers found — try changing your search/filter.</div>
{% endif %}
{% endblock %}
