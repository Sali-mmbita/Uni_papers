<!-- templates/my_papers.html -->
{% extends "base.html" %}
{% block title %}My Papers{% endblock %}

{% block content %}
<!--
  Shows paginated list of current user's papers (papers is paginate object)
-->
<div class="d-flex justify-content-between align-items-center mb-3">
  <div><h3 class="mb-0">My Papers</h3><small class="small-muted">Manage your uploads</small></div>
  <div><a class="btn btn-primary btn-sm" href="{{ url_for('main.upload') }}"><i class="bi bi-upload"></i> Upload</a></div>
</div>

{% if papers.items %}
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Title</th>
          <th>Subject</th>
          <th>Year</th>
          <th>Uploaded At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for paper in papers.items %}
        <tr>
          <td>{{ paper.title }}</td>
          <td>{{ paper.subject }}</td>
          <td>{{ paper.year }}</td>
          <td>{{ paper.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>
            <a class="btn btn-sm btn-info" href="{{ url_for('main.view_paper', paper_id=paper.id) }}"><i class="bi bi-eye"></i></a>
            <a class="btn btn-sm btn-secondary" href="{{ url_for('main.preview', paper_id=paper.id) }}" target="_blank"><i class="bi bi-file-earmark-text"></i></a>
            <a class="btn btn-sm btn-success" href="{{ url_for('main.download', paper_id=paper.id) }}"><i class="bi bi-download"></i></a>

            <form method="POST" action="{{ url_for('main.delete_paper', paper_id=paper.id) }}" style="display:inline;">
              {{ confirm_form.hidden_tag() }}
              <button class="btn btn-sm btn-danger" onclick="return confirm('Delete paper?')"><i class="bi bi-trash"></i></button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- pagination -->
  <nav>
    <ul class="pagination justify-content-center">
      {% if papers.has_prev %}
        <li class="page-item"><a class="page-link" href="{{ url_for('main.my_papers', page=papers.prev_num) }}">Prev</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Prev</span></li>
      {% endif %}

      <li class="page-item disabled"><span class="page-link">Page {{ papers.page }} / {{ papers.pages }}</span></li>

      {% if papers.has_next %}
        <li class="page-item"><a class="page-link" href="{{ url_for('main.my_papers', page=papers.next_num) }}">Next</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
{% else %}
  <div class="alert alert-info">You have not uploaded any papers yet.</div>
{% endif %}
{% endblock %}
